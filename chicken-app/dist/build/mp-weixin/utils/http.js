"use strict";const e=require("../common/vendor.js"),o=require("../stores/modules/user.js"),t={invoke(e){var t;e.url.startsWith("http")||(e.url="http://localhost:8081"+e.url),e.timeout=1e4,e.header={"source-client":"miniapp",...e.header};const s=null==(t=o.useUserStore().profile)?void 0:t.token;console.log("token",s),s&&(e.header.Authorization=s)}};e.index.addInterceptor("request",t);exports.http=t=>new Promise(((s,r)=>{e.index.request({...t,success(t){if(console.log("响应  ",t),t.statusCode>=200&&t.statusCode<300)s(t.data);else if(401===t.statusCode){o.useUserStore().clearProfile(),e.index.navigateTo({url:"/pages/login/login"}),r(t)}else e.index.showToast({title:t.data.msg||"请求失败",icon:"none"})},fail(o){e.index.showToast({title:"网络不行，换个试试？",icon:"none"}),r(o)}})}));
