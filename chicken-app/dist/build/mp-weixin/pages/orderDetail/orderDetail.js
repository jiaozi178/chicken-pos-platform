"use strict";const e=require("../../common/vendor.js"),o=require("../../api/order.js"),s=require("../../api/cart.js"),t=require("../../stores/modules/countdown.js");if(require("../../utils/http.js"),require("../../stores/modules/user.js"),!Array){e.resolveComponent("uni-countdown")()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-countdown/uni-countdown.js")+r)();const r=()=>"../../components/message/pushMsg.js",a=e.defineComponent({__name:"orderDetail",setup(r){const a=e.ref(null),n=[{status:0,name:"全部订单"},{status:1,name:"等待支付"},{status:2,name:"等待商家接单"},{status:3,name:"商家已接单"},{status:4,name:"正在派送中"},{status:5,name:"订单已完成"},{status:6,name:"订单已取消"}],u=t.useCountdownStore(),d=e.reactive({id:0,number:"",status:0,userId:0,addressBookId:0,orderTime:new Date,orderDetailList:[]});e.onLoad((async e=>{console.log("options",e),d.id=e.orderId,await i()}));const i=async()=>{console.log("获取订单详情");const e=await o.getOrderAPI(d.id);console.log("res",e),Object.assign(d,e.data),console.log("刷新得到新的order",d)},c=async()=>{console.log("取消订单");0===(await o.cancelOrderAPI(d.id)).code?e.index.showToast({title:"订单已取消",icon:"none"}):e.index.showModal({title:"提示",content:"商家已接单，欲取消订单请与商家联系！",showCancel:!1,success:function(e){e.confirm&&console.log("用户点击确定")}}),await i()},l=async()=>{console.log("催单");const e=await o.urgeOrderAPI(d.id);console.log("催单res信息",e.data),a.value&&a.value.openPopup()},m=async()=>{console.log("再来一单"),await s.cleanCartAPI(),await o.reOrderAPI(d.id),e.index.redirectTo({url:"/pages/order/order"})},w=()=>{console.log("联系商家"),e.index.makePhoneCall({phoneNumber:"1999"})},p=async()=>{console.log("支付成功");const s={orderNumber:d.number,payMethod:1};await o.payOrderAPI(s),void 0!==u.timer&&(clearInterval(u.timer),u.timer=void 0),e.index.redirectTo({url:"/pages/pay/pay?orderId="+d.id+"&orderNumber="+d.number+"&orderAmount="+d.amount+"&orderTime="+d.orderTime})};return(o,s)=>e.e({a:e.t(n[d.status].name),b:1===d.status},1===d.status?e.e({c:e.unref(u).showM<=0&&e.unref(u).showS<=0},e.unref(u).showM<=0&&e.unref(u).showS<=0?{}:{d:e.p({color:"#888","show-day":!1,"show-hour":!1,minute:e.unref(u).showM,second:e.unref(u).showS})}):{},{e:d.status<=2},d.status<=2?{f:e.o(c)}:{},{g:1===d.status&&(e.unref(u).showM>0||e.unref(u).showS>0)},1===d.status&&(e.unref(u).showM>0||e.unref(u).showS>0)?{h:e.o(p)}:{},{i:2===d.status},2===d.status?{j:e.o(l)}:{},{k:2===d.status||6===d.status},2===d.status||6===d.status?{l:e.o(m)}:{},{m:e.f(d.orderDetailList,((o,s,t)=>e.e({a:o.pic,b:e.t(o.name),c:o.dishFlavor},o.dishFlavor?{d:e.t(o.dishFlavor)}:{},{e:o.number&&o.number>0},o.number&&o.number>0?{f:e.t(o.number)}:{},{g:e.t(o.amount),h:s}))),n:e.t(d.packAmount),o:e.t(d.amount),p:e.o(w),q:e.t(d.remark),r:e.t(-1==d.tablewareNumber?"无需餐具":0==d.tablewareNumber?"商家根据餐量提供":d.tablewareNumber),s:e.t(d.number),t:e.t(d.orderTime),v:e.t(d.address),w:e.t(-1===d.packAmount?"无需餐具":0===d.packAmount?"按餐量提供":d.packAmount),x:e.sr(a,"2d7a98dc-1",{k:"childComp"})})}}),n=e._export_sfc(a,[["__scopeId","data-v-2d7a98dc"]]);wx.createPage(n);
