"use strict";const e=require("../../common/vendor.js"),a=require("../../api/address.js");require("../../utils/http.js"),require("../../stores/modules/user.js");const t=e.defineComponent({__name:"addOrEditAddress",setup(t){let o=["","",""];const d=e=>{console.log(e),c.value=e.detail.value.join(" "),console.log(c.value),o=e.detail.code,console.log(o),l.provinceCode=o[0],l.cityCode=o[1],l.districtCode=o[2]},n=e.ref("ios"),i=e.ref(!1),s=[{value:1,name:"男士"},{value:0,name:"女士"}],r=[{name:"公司"},{name:"家"},{name:"学校"}],l=e.reactive({id:0,consignee:"",phone:"",label:"",gender:1,provinceCode:"110000",provinceName:"",cityCode:"110100",cityName:"",districtCode:"110102",districtName:"",detail:""});e.ref("");const c=e.ref("北京市 市辖区 西城区"),u=e.ref();e.onLoad((async a=>{p(),a&&"编辑"===a.type?(u.value=-1,i.value=!0,e.index.setNavigationBarTitle({title:"编辑收货地址"}),u.value=a.id,await m(a.id)):i.value=!1})),e.onUnload((()=>{e.index.removeStorage({key:"edit"})}));const v=()=>e.index.getSystemInfoSync().statusBarHeight+"px",p=()=>{const a=e.index.getSystemInfoSync();n.value=a.platform},m=async e=>{const t=await a.getAddressByIdAPI(e);if(0===t.code){const e={provinceCode:t.data.provinceCode,cityCode:t.data.cityCode,districtCode:t.data.districtCode,phone:t.data.phone,consignee:t.data.consignee,gender:t.data.gender,label:t.data.label,detail:t.data.detail,id:t.data.id};Object.assign(l,e),t.data.provinceName&&t.data.cityName&&t.data.districtName&&(c.value=t.data.provinceName+"-"+t.data.cityName+"-"+t.data.districtName)}};return(t,o)=>{var p;return e.e({a:l.consignee,b:e.o((e=>l.consignee=e.detail.value)),c:e.f(s,((a,t,o)=>e.e({a:a.value!=l.gender},(a.value,l.gender,{}),{b:e.t(a.name),c:t,d:e.o((e=>{return t=a.value,l.gender=t,void console.log(l.gender);var t}),t)}))),d:l.phone,e:e.o((e=>l.phone=e.detail.value)),f:c.value},c.value?{g:e.t(c.value)}:{},{h:e.o(d),i:null==(p=c.value)?void 0:p.split(" "),j:"ios"==n.value?1:"",k:l.detail,l:e.o((e=>l.detail=e.detail.value)),m:e.f(r,((a,t,o)=>({a:e.t(a.name),b:l.label===a.name?1:"",c:a.name,d:e.o((e=>(e=>{console.log("点击了标签",e),l.label=e.name})(a)),a.name)}))),n:e.o((t=>(async()=>{if(""===l.consignee)return e.index.showToast({title:"联系人不能为空",duration:1e3,icon:"none"});if(""===l.phone)return e.index.showToast({title:"手机号不能为空",duration:1e3,icon:"none"});if(""===l.label)return e.index.showToast({title:"所属标签不能为空",duration:1e3,icon:"none"});if(""===c.value)return e.index.showToast({title:"所在地区不能为空",duration:1e3,icon:"none"});if(l.phone&&!/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/.test(l.phone))return e.index.showToast({title:"手机号输入有误",duration:1e3,icon:"none"});const t={...l,provinceName:c.value.split(" ")[0],cityName:c.value.split(" ")[1],districtName:c.value.split(" ")[2]};i.value?(console.log("update params !!!",t),0===(await a.updateAddressAPI(t)).code&&e.index.redirectTo({url:"/pages/address/address"})):(delete t.id,console.log("add params with label!",t),0===(await a.addAddressAPI(t)).code&&e.index.redirectTo({url:"/pages/address/address"}))})())),o:i.value},i.value?{p:e.o((t=>(async()=>{if(-1===u.value||!u.value)return e.index.showToast({title:"删除失败",duration:1e3,icon:"none"});0===(await a.deleteAddressAPI(u.value)).code&&(e.index.redirectTo({url:"/pages/address/address"}),e.index.showToast({title:"地址删除成功",duration:1e3,icon:"none"}),l.consignee="",l.phone="",l.label="",l.provinceCode="110000",l.cityCode="110100",l.districtCode="110102")})()))}:{},{q:`calc(100% - ${v} - 44px)`})}}}),o=e._export_sfc(t,[["__scopeId","data-v-0d827a25"]]);wx.createPage(o);
