"use strict";const e=require("../../common/vendor.js"),a=require("../../api/order.js"),t=require("../../api/cart.js");require("../../utils/http.js"),require("../../stores/modules/user.js"),Math||s();const s=()=>"../../components/message/pushMsg.js",o=e.defineComponent({__name:"history",setup(s){const o=e.ref(null),r=[{status:0,name:"全部订单"},{status:1,name:"待付款"},{status:5,name:"已完成"},{status:6,name:"已取消"}],u=[{status:0,name:"全部订单"},{status:1,name:"待付款"},{status:2,name:"待接单"},{status:3,name:"已接单"},{status:4,name:"派送中"},{status:5,name:"已完成"},{status:6,name:"已取消"}],n=e.ref(0),l=e.ref([]),i=e.ref({page:1,pageSize:6}),d=e.ref(0);e.onLoad((async()=>{console.log("首先分页获取所有订单信息",i.value),await c(0)})),e.onReachBottom((()=>{if(console.log("Page:",i.value.page),console.log("Page Size:",i.value.pageSize),i.value.page*i.value.pageSize>=d.value)return console.log("end!"),void e.index.showToast({title:"end!",icon:"none"});i.value.page+=1,c(n.value)}));const c=async(e,t)=>{n.value=e,console.log("根据status获取订单信息"),0!==e?i.value.status=r[e].status:delete i.value.status,console.log("orderDTO",i.value);const s=await a.getOrderPageAPI(i.value);"更改状态"===t?(l.value=s.data.records,i.value.page=1):l.value=l.value.concat(s.data.records),d.value=s.data.total};return(s,i)=>({a:e.f(r,((a,t,s)=>({a:e.t(a.name),b:t,c:t===n.value?1:"",d:e.o((e=>c(t,"更改状态")),t)}))),b:e.f(l.value,((s,r,n)=>e.e({a:e.t(s.number),b:e.f(s.orderDetailList,((e,a,t)=>({a:e.pic,b:a}))),c:e.t(s.orderTime),d:e.t(u[s.status].name),e:e.t(s.amount),f:e.t(s.packAmount),g:e.o((o=>(async s=>{console.log("再来一单",s),await t.cleanCartAPI(),await a.reOrderAPI(s),e.index.redirectTo({url:"/pages/order/order"})})(s.id)),r),h:2===s.status},2===s.status?{i:e.o((e=>{return a=s.id,console.log("催单",a),void o.value.openPopup();var a}),r)}:{},{j:r,k:e.o((a=>{return t=s.id,void e.index.navigateTo({url:"/pages/orderDetail/orderDetail?orderId="+t});var t}),r)}))),c:e.sr(o,"823fb0b7-0",{k:"childComp"})})}}),r=e._export_sfc(o,[["__scopeId","data-v-823fb0b7"]]);wx.createPage(r);
