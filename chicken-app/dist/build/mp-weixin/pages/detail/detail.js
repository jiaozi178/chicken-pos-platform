"use strict";const e=require("../../common/vendor.js"),a=require("../../api/category.js"),l=require("../../api/cart.js"),o=require("../../api/dish.js"),s=require("../../api/setmeal.js");require("../../utils/http.js"),require("../../stores/modules/user.js");const t=e.defineComponent({__name:"detail",setup(t){const u=e.ref([]),i=e.ref(),n=e.ref(),d=e.ref(!1),v=e.ref([]),r=e.ref(0),c=e.ref(0),g=e.ref(!1),m=e.ref(),h=e.ref([]),I=e.ref([]);e.onLoad((async e=>{await p(),await b(),e&&"dishId"in e?(console.log("dishId",e.dishId),f(e.dishId,"dishId")):(console.log("setmealId",null==e?void 0:e.setmealId),f(null==e?void 0:e.setmealId,"setmealId"))}));const f=async(e,a)=>{let l;console.log("init",e,a),"dishId"===a?(l=await o.getDishByIdAPI(e),i.value=l.data):(l=await s.getSetmealAPI(e),n.value=l.data),console.log(l),console.log(i.value),console.log(n.value)},b=async()=>{const e=await a.getCategoryAPI();console.log(e),u.value=e.data,console.log("categoryList",u.value)},p=async()=>{const e=await l.getCartAPI();console.log("初始化购物车列表",e),v.value=e.data,r.value=v.value.reduce(((e,a)=>e+a.number),0),c.value=v.value.reduce(((e,a)=>e+a.amount*a.number),0),console.log("CartAllNumber",r.value),console.log("CartAllPrice",c.value),0===v.value.length&&(d.value=!1)},w=e=>{var a,l,o;console.log("getCopies",e);const s=null==(a=u.value.find((a=>a.id===e.categoryId)))?void 0:a.sort;return console.log("category？",s),s&&s<20?(null==(l=v.value.find((a=>a.dishId===e.id)))?void 0:l.number)||0:(null==(o=v.value.find((a=>a.setmealId===e.id)))?void 0:o.number)||0},C=async(e,a)=>{if(console.log("点击了 “+” 添加菜品数量按钮",e,a),"购物车"==a){console.log("addCart",e);const a={dishId:e.dishId,setmealId:e.setmealId,dishFlavor:e.dishFlavor};await l.addToCartAPI(a)}else if("菜品"==a){const e={dishId:i.value.id};await l.addToCartAPI(e)}else{const e={setmealId:n.value.id};await l.addToCartAPI(e)}await p()},y=async(e,a)=>{if(console.log("点击了减少菜品数量按钮subDishAction--------------------",e,a),"购物车"==a){console.log("subCart",e);const a={dishId:e.dishId,setmealId:e.setmealId,dishFlavor:e.dishFlavor};await l.subCartAPI(a)}else if("菜品"==a){const e={dishId:i.value.id};await l.subCartAPI(e)}else{const e={setmealId:n.value.id};await l.subCartAPI(e)}await p()};return(a,o)=>{var s;return e.e({a:i.value},i.value?e.e({b:i.value.pic,c:e.t(i.value.name),d:e.t(i.value.detail),e:e.t(i.value.price),f:i.value&&"flavors"in i.value&&i.value.flavors.length>0},i.value&&"flavors"in i.value&&i.value.flavors.length>0?{g:e.o((e=>(async e=>{console.log("点击了选择规格chooseNorm，得到了该菜品的所有口味数据",e.flavors),h.value=e.flavors;const a=Object.assign({},e);delete a.flavors,m.value=a,e.flavors.map((e=>({...e,list:JSON.parse(e.list)}))).forEach((e=>{e.list&&e.list.length>0&&I.value.push(e.list[0])})),g.value=!0})(i.value)))}:e.e({h:w(i.value)>0},w(i.value)>0?{i:e.o((e=>y(i.value,"菜品")))}:{},{j:w(i.value)>0},w(i.value)>0?{k:e.t(w(i.value))}:{},{l:e.o((e=>C(i.value,"菜品")))})):{},{m:n.value},n.value?e.e({n:e.f(n.value.setmealDishes,((a,l,o)=>({a:a.pic,b:e.t(a.name),c:e.t(a.detail),d:a.name}))),o:e.t(n.value.detail),p:e.t(null==(s=n.value)?void 0:s.price),q:w(n.value)>0},w(n.value)>0?{r:e.o((e=>y(n.value,"套餐")))}:{},{s:w(n.value)>0},w(n.value)>0?{t:e.t(w(n.value))}:{},{v:e.o((e=>C(n.value,"套餐")))}):{},{w:e.f(h.value,((a,l,o)=>({a:e.t(a.name),b:e.f(JSON.parse(a.list),((l,o,s)=>({a:e.t(l),b:-1!==I.value.findIndex((e=>l===e))?1:"",c:o,d:e.o((e=>((e,a)=>{console.log("chooseFlavor",a);let l=-1,o=e.some((e=>(l=I.value.findIndex((a=>a==e)),-1!=l)));const s=I.value.findIndex((e=>e==a));console.log("ind",l),console.log("indexInChosed",s),-1!=s||o?-1==s&&o&&l>=0?(console.log("2、当前口味没选过，但当前行选过口味，替换掉当前行选过的口味"),I.value.splice(l,1),I.value.push(a)):(console.log("3、当前口味选过，进行反选操作，也就是直接删除"),I.value.splice(s,1)):(console.log("1、当前口味没选过，且当前行没选过口味"),I.value.push(a)),m.value.flavors=I.value.join(","),console.log("选好口味后，看看带口味字符串的，dialog中的菜品长什么样？ dialogDish",m.value)})(JSON.parse(a.list),l)),o)}))),c:a.name}))),x:e.o((a=>(async a=>{if(console.log("dialog中点击加入购物车addToCart, dialogdish:",a),!I.value||I.value.length<=0)return e.index.showToast({title:"请选择规格",icon:"none"}),!1;const o={dishId:a.id,dishFlavor:I.value.join(",")};await l.addToCartAPI(o),await p(),I.value=[],g.value=!1})(m.value))),y:g.value,z:0===v.value.length},0===v.value.length?{}:{A:e.t(r.value),B:e.t(parseFloat((Math.round(100*c.value)/100).toFixed(2))),C:e.o((a=>(console.log("submitOrder"),void e.index.navigateTo({url:"/pages/submit/submit"})))),D:e.o((()=>d.value=!d.value))},{E:e.o((e=>(async()=>{await l.cleanCartAPI(),await p(),d.value=!1})())),F:e.f(v.value,((a,l,o)=>e.e({a:a.pic,b:e.t(a.name),c:e.t(a.amount),d:e.t(a.dishFlavor),e:a.number&&a.number>0},a.number&&a.number>0?{f:e.o((e=>y(a,"购物车")),l)}:{},{g:a.number&&a.number>0},a.number&&a.number>0?{h:e.t(a.number)}:{},{i:e.o((e=>C(a,"购物车")),l),j:l}))),G:e.o((e=>d.value=d.value)),H:d.value,I:e.o((e=>d.value=!d.value))})}}}),u=e._export_sfc(t,[["__scopeId","data-v-4a8ee7ea"]]);wx.createPage(u);
