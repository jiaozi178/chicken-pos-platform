"use strict";const e=require("../../common/vendor.js"),o=require("../../stores/modules/user.js"),a=require("../../api/user.js");require("../../utils/http.js");const n=e.defineComponent({__name:"updateMy",setup(n){const s=o.useUserStore(),t=e.reactive({id:s.profile.id,name:"",gender:1,phone:"未设置",pic:""}),i=[{value:1,name:"男士"},{value:0,name:"女士"}];e.onLoad((async()=>{console.log("userStore",s.profile),await c(t.id)}));const c=async e=>{const o=await a.getUserInfoAPI(e);console.log("用户信息",o),t.name=o.data.name,t.gender=o.data.gender??1,t.phone=o.data.phone,t.pic=o.data.pic,console.log("user",t)},r=()=>{console.log("picChange"),e.index.chooseMedia({count:1,mediaType:["image"],sourceType:["album","camera"],maxDuration:15,camera:"back",success:o=>{console.log(o);const{tempFilePath:a}=o.tempFiles[0];let n="";e.wx$1.getFileSystemManager().readFile({filePath:a,encoding:"base64",success:e=>{n="data:image/png;base64,"+e.data,console.log(n),t.pic=n}})}})},d=async()=>{if(console.log("submit",t),!(()=>{let o=!0;return t.name||(e.index.showToast({title:"昵称不能为空",icon:"none"}),o=!1),t.phone?/^1[3-9]\d{9}$/.test(t.phone)||(e.index.showToast({title:"手机号格式不正确",icon:"none"}),o=!1):(e.index.showToast({title:"手机号不能为空",icon:"none"}),o=!1),o})())return;0===(await a.updateUserAPI(t)).code&&(e.index.showToast({title:"修改成功",icon:"success"}),e.index.switchTab({url:"/pages/my/my"}))};return(o,a)=>e.e({a:!t.pic},t.pic?{b:t.pic}:{},{c:e.o(r),d:e.f(i,((o,a,n)=>e.e({a:o.value!=t.gender},(o.value,t.gender,{}),{b:e.t(o.name),c:a,d:e.o((e=>{return a=o.value,t.gender=a,void console.log(t.gender);var a}),a)}))),e:t.name,f:e.o((e=>t.name=e.detail.value)),g:t.phone,h:e.o((e=>t.phone=e.detail.value)),i:e.o(d)})}}),s=e._export_sfc(n,[["__scopeId","data-v-ecf87ed1"]]);wx.createPage(s);
