"use strict";const e=require("../../common/vendor.js"),o=require("../../api/order.js"),r=require("../../stores/modules/countdown.js");if(require("../../utils/http.js"),require("../../stores/modules/user.js"),!Array){e.resolveComponent("uni-countdown")()}Math;const t=e.defineComponent({__name:"pay",setup(t){const l=r.useCountdownStore(),s=e.ref(0),a=e.ref(""),n=e.ref(0),u=e.ref();e.ref(null),e.onLoad((async e=>{console.log("orderTime什么东西？",e),s.value=e.orderId,a.value=e.orderNumber,n.value=e.orderAmount,u.value=e.orderTime.replace(" ","T")}));const i=async()=>{await o.cancelOrderAPI(s.value)};return(r,t)=>e.e({a:0==e.unref(l).showM&&0==e.unref(l).showS},0==e.unref(l).showM&&0==e.unref(l).showS?{}:{b:e.o((o=>(()=>{console.log("------------ 执行了一次倒计时timeup ---------------");let o=e.ref(20);void 0!==l.timer&&clearInterval(l.timer),l.timer=setInterval((()=>{console.log("什么timer？",l.timer),console.log("看看是不是一秒执行一次",u.value);let e=new Date(u.value).getTime()+9e5-(new Date).getTime();if(console.log("time",e),e>0&&void 0!==l.timer){var r=e/1e3/60%60;console.log("m",r);var t=e/1e3%60;console.log("s",t),o.value=e/1e3,console.log("timeupSecond小于0？",o.value),l.showM=Math.floor(r),l.showS=Math.floor(t)}else console.log("订单已超时！"),clearInterval(l.timer),l.showM=-1,l.showS=-1,i()}),1e3)})())),c:e.p({color:"#888","show-day":!1,"show-hour":!1,minute:e.unref(l).showM,second:e.unref(l).showS})},{d:e.t(n.value),e:e.t(a.value),f:e.o((r=>(async()=>{if(-1==l.showM&&-1==l.showS)return void e.index.redirectTo({url:"/pages/orderDetail/orderDetail?orderId="+s.value});console.log("支付成功");const r={orderNumber:a.value,payMethod:1};await o.payOrderAPI(r),void 0!==l.timer&&(clearInterval(l.timer),l.timer=void 0),e.index.redirectTo({url:"/pages/submit/success?orderId="+s.value+"&orderNumber="+a.value+"&orderAmount="+n.value+"&orderTime="+u.value})})()))})}}),l=e._export_sfc(t,[["__scopeId","data-v-c1674519"]]);wx.createPage(l);
