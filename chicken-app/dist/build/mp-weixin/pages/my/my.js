"use strict";const e=require("../../common/vendor.js"),a=require("../../stores/modules/user.js"),o=require("../../api/user.js"),t=require("../../api/order.js"),r=require("../../api/cart.js");require("../../utils/http.js"),Math||s();const s=()=>"../../components/message/pushMsg.js",n=e.defineComponent({__name:"my",setup(s){const n=a.useUserStore(),i=e.ref(null),d=[{status:0,name:"全部订单"},{status:1,name:"待付款"},{status:2,name:"待接单"},{status:3,name:"已接单"},{status:4,name:"派送中"},{status:5,name:"已完成"},{status:6,name:"已取消"}],u=e.reactive({id:n.profile.id,name:"",gender:1,phone:"未设置",pic:""}),c=e.ref([]),l=e.ref({page:1,pageSize:6}),p=e.ref(0);e.onLoad((async e=>{console.log("options",e),console.log("userStore",n.profile),await g(u.id),await m()}));const g=async e=>{const a=await o.getUserInfoAPI(e);console.log("用户信息",a),u.name=a.data.name,u.gender=a.data.gender??1,u.phone=a.data.phone,u.pic=a.data.pic},m=async()=>{console.log("orderDTO",l.value);const e=await t.getOrderPageAPI(l.value);c.value=c.value.concat(e.data.records),p.value=e.data.total};e.onReachBottom((()=>{if(console.log("Page:",l.value.page),console.log("Page Size:",l.value.pageSize),l.value.page*l.value.pageSize>=Math.min(p.value,12))return console.log("end!"),void e.index.showToast({title:"更多订单信息请到历史订单查看！",icon:"none"});l.value.page+=1,m()}));const v=()=>{e.index.redirectTo({url:"/pages/address/address"})},h=()=>{e.index.redirectTo({url:"/pages/history/history"})},f=()=>{e.index.redirectTo({url:"/pages/updateMy/updateMy"})};return(a,o)=>e.e({a:u.pic,b:e.t(u.name),c:0===u.gender},(u.gender,{}),{d:e.t(u.phone),e:e.o(v),f:e.o(h),g:e.o(f),h:e.f(c.value,((a,o,s)=>e.e({a:e.t(a.number),b:e.f(a.orderDetailList,((e,a,o)=>({a:e.pic,b:a}))),c:e.t(a.orderTime),d:e.t(d[a.status].name),e:e.t(a.amount),f:e.t(a.packAmount),g:e.o((o=>(async a=>{console.log("再来一单",a),await r.cleanCartAPI(),await t.reOrderAPI(a),e.index.redirectTo({url:"/pages/order/order"})})(a.id)),o),h:2===a.status},2===a.status?{i:e.o((e=>(async e=>{console.log("催单",e),await t.urgeOrderAPI(e),i.value.openPopup()})(a.id)),o)}:{},{j:o,k:e.o((o=>{return t=a.id,void e.index.navigateTo({url:"/pages/orderDetail/orderDetail?orderId="+t});var t}),o)}))),i:e.sr(i,"730ac39b-0",{k:"childComp"})})}}),i=e._export_sfc(n,[["__scopeId","data-v-730ac39b"]]);wx.createPage(i);
