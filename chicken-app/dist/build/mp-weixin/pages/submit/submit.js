"use strict";const e=require("../../common/vendor.js"),a=require("../../api/address.js"),t=require("../../api/cart.js"),r=require("../../api/order.js"),o=require("../../stores/modules/address.js");require("../../utils/http.js"),require("../../stores/modules/user.js");const l=e.defineComponent({__name:"submit",setup(l){const u=o.useAddressStore(),s=e.ref([]),n=e.ref(0),d=e.ref(0),v=e.ref(""),i=e.ref(""),c=e.ref(""),m=e.ref(0),g=e.ref(""),f=e.ref("");e.ref("ios");const p=e.ref(!1),b=e.ref(-2),w=e.ref([-1,0,1,2,3,4,5,6,7,8,9,10,11]),h=e.ref(!1),y=e.ref(""),k=e.ref(""),A=e.ref(0),N=async()=>{const e=await t.getCartAPI();console.log("初始化购物车列表",e),s.value=e.data,n.value=s.value.reduce(((e,a)=>e+a.number),0),d.value=s.value.reduce(((e,a)=>e+a.amount*a.number),0)+n.value+6,console.log("CartAllNumber",n.value),console.log("CartAllPrice",d.value)};e.onLoad((async e=>{if(await x(),console.log("options",e),e.address){const a=JSON.parse(e.address);console.log("获取新的地址啊！addressObj",a),A.value=a.id,i.value=a.label,v.value=a.provinceName+a.cityName+a.districtName+a.detail,g.value=a.phone,c.value=a.consignee}else e.remark&&(y.value=e.remark);console.log("我地址id赋值了啊1-------------",A.value),await N(),T(),"无需餐具"===u.defaultCook?b.value=-1:"商家依据餐量提供"===u.defaultCook&&(b.value=0)})),e.onShow((async e=>{console.log("options",e),await N()}));const T=()=>{const e=new Date;e.setTime(e.getTime()+36e5);const a=(e=>{var a=e.getFullYear(),t=e.getMonth(),r=e.getDate(),o=e.getHours(),l=e.getMinutes(),u=e.getSeconds();return a+"-"+(t+1>9?t+1:"0"+(t+1))+"-"+(r>9?r:"0"+r)+" "+(o>9?o:"0"+o)+":"+(l>9?l:"0"+l)+":"+(u>9?u:"0"+u)})(e);f.value=a;let t=e.getHours(),r=e.getMinutes();t<10&&(t=parseInt("0"+t)),r<10&&(r=parseInt("0"+r)),k.value=t+":"+r},x=async()=>{const e=await a.getDefaultAddressAPI();0===e.code&&(console.log("默认地址",e.data),A.value=0,e.data.provinceName&&(v.value=e.data.provinceName+e.data.cityName+e.data.districtName+e.data.detail),g.value=e.data.phone,c.value=e.data.consignee,m.value=e.data.gender,A.value=e.data.id)},j=e=>{switch(e){case"公司":return"1";case"家":return"2";case"学校":return"3";default:return"4"}},C=()=>{u.addressBackUrl="/pages/submit/submit",e.index.redirectTo({url:"/pages/address/address"})},I=()=>{e.index.redirectTo({url:"/pages/remark/remark"})},q=()=>{p.value=!0},P=e=>{console.log(e.detail.value),b.value=e.detail.value[0]-1},F=()=>{h.value=!h.value,h.value?u.defaultCook=-1===b.value?"无需餐具":"商家依据餐量提供":u.defaultCook="请依据实际情况填写，避免浪费"},S=()=>{p.value=!1};return(a,t)=>e.e({a:!v.value},(v.value,{}),{b:v.value},v.value?{c:e.t(i.value||"其他"),d:e.n("tag"+j(i.value)),e:e.t(v.value),f:e.t(c.value),g:e.t(g.value)}:{},{h:e.o(C),i:e.t(k.value),j:e.f(s.value,((a,t,r)=>e.e({a:a.pic,b:e.t(a.name),c:a.dishFlavor},a.dishFlavor?{d:e.t(a.dishFlavor)}:{},{e:a.number&&a.number>0},a.number&&a.number>0?{f:e.t(a.number)}:{},{g:e.t(a.amount),h:t}))),k:e.t(n.value),l:e.t(d.value),m:e.t(y.value||"选择口味等"),n:e.o(I),o:e.t(-2===b.value?"请依据实际情况填写，避免浪费":-1===b.value?"无需餐具":0===b.value?"商家依据餐量提供":11===b.value?"10份以上":b.value+"份"),p:e.o(q),q:e.t(n.value),r:e.t(parseFloat((Math.round(100*d.value)/100).toFixed(2))),s:e.o((a=>(async()=>{const a=await r.getUnPayOrderAPI();if(console.log("未支付订单",a),0!==a.data)return console.log("有未支付订单",a.data),e.index.showToast({title:"有未支付订单，请先支付或取消！",icon:"none"}),!1;if(!v.value)return e.index.showToast({title:"请选择收货地址",icon:"none"}),!1;if(-2===b.value)return e.index.showToast({title:"请选择餐具份数",icon:"none"}),!1;console.log("我传地址id了啊2--------------",A.value);const t={payMethod:1,addressId:A.value,remark:y.value,estimatedDeliveryTime:f.value,deliveryStatus:1,tablewareNumber:b.value,tablewareStatus:0===b.value?1:0,packAmount:n.value,amount:d.value};console.log("生成订单params",t);const o=await r.submitOrderAPI(t);0===o.code?(console.log("订单生成成功",o.data),e.index.redirectTo({url:"/pages/pay/pay?orderId="+o.data.id+"&orderAmount="+o.data.orderAmount+"&orderNumber="+o.data.orderNumber+"&orderTime="+o.data.orderTime})):e.index.showToast({title:o.msg||"操作失败",icon:"none"})})())),t:e.o(S),v:e.f(w.value,((a,t,r)=>({a:e.t(-1===a?"无需餐具":0===a?"商家依据餐量提供":11===a?"10份以上":a+"份"),b:a}))),w:w.value,x:e.o(P),y:h.value,z:e.o(F),A:e.t(-2===b.value||-1===b.value?"以后都无需餐具":"以后都需要餐具，商家依据餐量提供"),B:e.o((e=>p.value=!p.value)),C:e.o((e=>p.value=p.value)),D:p.value,E:e.o((e=>p.value=!p.value))})}}),u=e._export_sfc(l,[["__scopeId","data-v-a6ebdd4a"]]);wx.createPage(u);
